{"ast":null,"code":"'use strict'; //\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\n\nconst tokenChars = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\n\nfunction push(dest, name, elem) {\n  if (Object.prototype.hasOwnProperty.call(dest, name)) dest[name].push(elem);else dest[name] = [elem];\n}\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\n\n\nfunction parse(header) {\n  const offers = {};\n  if (header === undefined || header === '') return offers;\n  var params = {};\n  var mustUnescape = false;\n  var isEscaping = false;\n  var inQuotes = false;\n  var extensionName;\n  var paramName;\n  var start = -1;\n  var end = -1;\n\n  for (var i = 0; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20\n      /* ' ' */\n      || code === 0x09\n      /* '\\t' */\n      ) {\n          if (end === -1 && start !== -1) end = i;\n        } else if (code === 0x3b\n      /* ';' */\n      || code === 0x2c\n      /* ',' */\n      ) {\n          if (start === -1) {\n            throw new SyntaxError(`Unexpected character at index ${i}`);\n          }\n\n          if (end === -1) end = i;\n          const name = header.slice(start, end);\n\n          if (code === 0x2c) {\n            push(offers, name, params);\n            params = {};\n          } else {\n            extensionName = name;\n          }\n\n          start = end = -1;\n        } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d\n      /* '=' */\n      && start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (start === -1) start = i;else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22\n        /* '\"' */\n        && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c\n        /* '\\' */\n        ) {\n            isEscaping = true;\n          } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        var value = header.slice(start, end);\n\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n\n        push(params, paramName, value);\n\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n\n  if (extensionName === undefined) {\n    push(offers, token, {});\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\n\n\nfunction format(extensions) {\n  return Object.keys(extensions).map(extension => {\n    var configurations = extensions[extension];\n    if (!Array.isArray(configurations)) configurations = [configurations];\n    return configurations.map(params => {\n      return [extension].concat(Object.keys(params).map(k => {\n        var values = params[k];\n        if (!Array.isArray(values)) values = [values];\n        return values.map(v => v === true ? k : `${k}=${v}`).join('; ');\n      })).join('; ');\n    }).join(', ');\n  }).join(', ');\n}\n\nmodule.exports = {\n  format,\n  parse\n};","map":{"version":3,"sources":["C:/Users/Saralin/IdeaProjects/fullstack-typescript-mern-todo/client/node_modules/ws/lib/extension.js"],"names":["tokenChars","push","dest","name","elem","Object","prototype","hasOwnProperty","call","parse","header","offers","undefined","params","mustUnescape","isEscaping","inQuotes","extensionName","paramName","start","end","i","length","code","charCodeAt","SyntaxError","slice","value","replace","token","format","extensions","keys","map","extension","configurations","Array","isArray","concat","k","values","v","join","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push (dest, name, elem) {\n  if (Object.prototype.hasOwnProperty.call(dest, name)) dest[name].push(elem);\n  else dest[name] = [elem];\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse (header) {\n  const offers = {};\n\n  if (header === undefined || header === '') return offers;\n\n  var params = {};\n  var mustUnescape = false;\n  var isEscaping = false;\n  var inQuotes = false;\n  var extensionName;\n  var paramName;\n  var start = -1;\n  var end = -1;\n\n  for (var i = 0; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20/* ' ' */|| code === 0x09/* '\\t' */) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b/* ';' */ || code === 0x2c/* ',' */) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = {};\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d/* '=' */&& start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22/* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c/* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        var value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = {};\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, {});\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\nfunction format (extensions) {\n  return Object.keys(extensions).map((extension) => {\n    var configurations = extensions[extension];\n    if (!Array.isArray(configurations)) configurations = [configurations];\n    return configurations.map((params) => {\n      return [extension].concat(Object.keys(params).map((k) => {\n        var values = params[k];\n        if (!Array.isArray(values)) values = [values];\n        return values.map((v) => v === true ? k : `${k}=${v}`).join('; ');\n      })).join('; ');\n    }).join(', ');\n  }).join(', ');\n}\n\nmodule.exports = { format, parse };\n"]},"metadata":{},"sourceType":"script"}